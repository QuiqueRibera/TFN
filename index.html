<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Centraleta del Cervell</title>
    <style>
        /* --- EST√âTICA --- */
        :root {
            --bg-color: #f8fafc;
            --text-color: #334155;
            
            /* Colores de Canales */
            --c-red: #ef4444;    /* Mano */
            --c-blue: #3b82f6;   /* Habla */
            --c-green: #10b981;  /* Dolor/Coraz√≥n */
            --c-yellow: #eab308; /* Sue√±o/Fatiga */
            --c-orange: #f97316; /* Pie/Marcha */

            --card-bg: rgba(255, 255, 255, 0.98);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
        }

        .scrolly-container {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* --- GR√ÅFICO FIJO --- */
        .graphic-stage {
            position: sticky;
            top: 0;
            z-index: 1;
            width: 100%;
            height: 50vh; 
            background: radial-gradient(circle at center, #ffffff 0%, #e2e8f0 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            transition: background 0.5s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border-bottom: none; 
        }

        /* --- TEXTOS --- */
        .narrative-column {
            position: relative;
            z-index: 2;
            margin-top: -5vh; 
            padding-bottom: 40vh;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .step {
            min-height: 85vh; 
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0.2; 
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .step.active {
            opacity: 1;
            transform: translateY(-10px);
        }

        .text-card {
            background: var(--card-bg);
            padding: 1.5rem; 
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 2px solid #fff;
            width: 90%;
            text-align: center;
        }

        h2 { margin: 0 0 0.5rem 0; color: #1e293b; font-size: 1.5rem; }
        p { margin: 0; color: #64748b; line-height: 1.6; }

        /* --- SVG GENERAL --- */
        svg {
            width: 100%;
            height: 100%;
            max-width: 600px;
        }
        
        /* FIX FIREFOX: Solo aplicamos transform-box a elementos que se transforman con CSS */
        .headset, .alert-marker, .battery-fill, .scan-laser, .hardware-ok, .brain-fill-rect, #main-scene {
            transform-box: fill-box;
            transform-origin: center;
        }

        /* --- ELEMENTOS GR√ÅFICOS --- */
        
        .headset { fill: #334155; }

        /* CEREBRO */
        .brain-outline {
            fill: none;
            stroke: #db2777; 
            stroke-width: 3;
            pointer-events: none;
            z-index: 10;
        }
        
        /* El l√≠quido del cerebro */
        .brain-fill-rect {
            fill: #fbcfe8; 
            transition: fill 0.5s;
            /* Controlamos la altura con transform scaleY */
            transform-origin: bottom;
            transform: scaleY(1);
        }

        /* Cables Generales */
        .cable {
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: opacity 0.5s, stroke-width 0.3s, stroke 0.3s;
            opacity: 0.2; 
        }

        .c-straight { opacity: 1; }
        .c-tangled { opacity: 0; }

        /* Colores */
        .stroke-red { stroke: var(--c-red); }
        .stroke-blue { stroke: var(--c-blue); }
        .stroke-green { stroke: var(--c-green); }
        .stroke-yellow { stroke: var(--c-yellow); }
        .stroke-orange { stroke: var(--c-orange); }

        .dest-icon {
            font-size: 30px;
            opacity: 0.5;
            transition: opacity 0.3s, transform 0.3s;
            text-anchor: middle;
            user-select: none;
        }

        /* Se√±ales (Bolas) */
        /* FIX FIREFOX: Eliminado r:4 de CSS, ahora est√° en HTML */
        .signal-dot { 
            fill: #fff; 
            stroke-width: 1.5; 
            transition: opacity 0.3s; 
        }
        
        /* Viajeros (Emojis) */
        .traveler-emoji { 
            font-size: 30px; /* Tama√±o grande igualado */
            opacity: 0; 
            transition: opacity 0.3s; 
            text-anchor: middle; 
            dominant-baseline: middle; 
        }
        
        .fill-red { fill: var(--c-red); }
        .fill-blue { fill: var(--c-blue); }
        .fill-green { fill: var(--c-green); }
        .fill-yellow { fill: var(--c-yellow); }
        .fill-orange { fill: var(--c-orange); }

        /* Marcadores de Alerta Est√°ticos */
        .alert-marker {
            font-size: 40px;
            opacity: 0; 
            pointer-events: none;
            transition: opacity 0.3s;
            text-anchor: middle;
            dominant-baseline: middle;
        }

        /* Bater√≠a */
        .battery-container {
            transition: opacity 0.5s, transform 0.5s;
        }
        .battery-body { fill: white; stroke: #334155; stroke-width: 2; }
        .battery-fill { fill: #10b981; transition: fill 0.5s; }

        /* Esc√°ner */
        .scan-laser {
            stroke: #10b981;
            stroke-width: 3;
            opacity: 0;
            filter: drop-shadow(0 0 5px #10b981);
        }
        .hardware-ok {
            font-size: 20px;
            fill: #10b981;
            opacity: 0;
            text-anchor: middle;
            transition: opacity 0.5s 0.5s;
        }

        /* --- L√ìGICA DE ESTADOS Y ANIMACIONES --- */

        /* PASO 1: NORMAL */
        .state-1 .c-straight { opacity: 1; }
        .state-1 .c-tangled { opacity: 0; }
        .state-1 .dest-icon { opacity: 1; }
        .state-1 .dots-normal { opacity: 1; }
        .state-1 .dots-chaos { opacity: 0; }

        /* PASO 2: CAOS */
        .state-2 .c-straight { opacity: 0; }
        .state-2 .c-tangled { opacity: 1; }
        .state-2 .dest-icon { opacity: 1; }
        .state-2 .dots-normal { opacity: 0; }
        .state-2 .dots-chaos { opacity: 1; }
        .state-2 .brain-fill-rect { fill: #fca5a5; } 

        /* 3. TEMBLORES */
        .state-3 .c-tangled { opacity: 0.1; } 
        .state-3 .c-tangled.stroke-red { opacity: 1; } 
        .state-3 .icon-hand { opacity: 1; font-size: 50px; animation: shake 0.2s infinite; }
        .state-3 .dots-chaos circle { opacity: 0; }
        .state-3 .trav-hand { opacity: 1; animation: travel-shake 0.2s infinite; }
        .state-3 .alert-tremor { opacity: 1; }

        /* 4. FATIGA */
        .state-4 .c-tangled { opacity: 0.1; }
        .state-4 .c-tangled.stroke-yellow { opacity: 1; }
        .state-4 .icon-sleep { opacity: 1; font-size: 50px; animation: pulse-slow 2s infinite; }
        .state-4 .dots-chaos circle { opacity: 0.2; transition: opacity 2s; }
        
        /* Animaci√≥n de la bater√≠a en bucle con pausa */
        .state-4 .battery-container { opacity: 1; transform: scale(1.5) translate(-10px, -10px); }
        .state-4 .battery-fill { animation: battery-drain 5s infinite; } /* 3s descarga + 2s espera */
        .state-4 .brain-fill-rect { animation: brain-liquid-drain 5s infinite; }
        .state-4 .alert-fatigue { opacity: 1; }

        /* 5. CAMINAR */
        .state-5 .c-tangled { opacity: 0.1; }
        .state-5 .c-tangled.stroke-orange { opacity: 1; stroke-width: 6; }
        .state-5 .icon-foot { opacity: 1; font-size: 50px; animation: wobble 1s infinite; }
        .state-5 .dots-chaos circle:not(.fill-orange) { opacity: 0; }
        .state-5 .trav-foot { opacity: 1; animation: travel-zigzag 0.6s infinite alternate; }
        .state-5 .alert-gait { opacity: 1; }

        /* 6. MAREO */
        .state-6 .c-tangled { opacity: 0.1; }
        .state-6 .alert-dizzy { opacity: 1; animation: spin 2s infinite linear; }
        .state-6 .dots-chaos { opacity: 0; }
        .state-6 #main-scene { animation: dizzy-sway 3s infinite ease-in-out; }

        /* 7. HABLA */
        .state-7 .c-tangled { opacity: 0.1; }
        .state-7 .c-tangled.stroke-blue { opacity: 1; stroke-width: 6; }
        .state-7 .icon-speech { opacity: 1; font-size: 50px; }
        .state-7 .dots-chaos circle:not(.fill-blue) { opacity: 0; }
        .state-7 .trav-speech { opacity: 1; } 
        .state-7 .alert-speech { opacity: 1; animation: jitter 0.5s infinite; }

        /* 8. DOLOR */
        .state-8 .c-tangled { opacity: 0.1; }
        .state-8 .c-tangled.stroke-green { opacity: 1; stroke-width: 6; }
        .state-8 .icon-heart { opacity: 1; font-size: 50px; }
        .state-8 .trav-pain { opacity: 1; animation: pain-pulse 1s infinite; }
        .state-8 .alert-pain { opacity: 1; animation: flash 0.8s infinite; }

        /* 9. ESC√ÅNER */
        .state-9 .c-tangled { opacity: 0.2; }
        .state-9 .scan-laser { opacity: 1; animation: scanning-line 3s infinite linear; }
        .state-9 .hardware-ok { opacity: 1; animation: pop-in 0.5s ease forwards; }
        .state-9 .brain-fill-rect { fill: #fbcfe8; } 

        /* 10. TERAPIA */
        .state-10 .c-tangled { opacity: 0; }
        .state-10 .c-straight { opacity: 1; stroke-dasharray: 1000; animation: dash 2s forwards; }
        .state-10 .dest-icon { opacity: 1; }
        .state-10 .dots-normal { opacity: 1; }
        .state-10 .dots-chaos { opacity: 0; } 
        .state-10 .brain-fill-rect { fill: #fbcfe8; }

        /* ANIMACIONES CSS */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes wobble { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(-15deg); } 75% { transform: rotate(15deg); } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes pulse-slow { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes jitter { 0% { transform: scale(1); } 20% { transform: scale(1.2); } 40% { transform: scale(0.9); } }
        @keyframes flash { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
        @keyframes scanning-line { 0% { transform: translateY(-50px); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(450px); opacity: 0; } }
        @keyframes dash { from { stroke-dashoffset: 1000; } to { stroke-dashoffset: 0; } }
        @keyframes pop-in { 0% { transform: scale(0); opacity: 0; } 80% { transform: scale(1.2); } 100% { transform: scale(1); opacity: 1; } }
        
        /* Bater√≠a: Descarga 60% tiempo, Espera 40% tiempo */
        @keyframes battery-drain {
            0% { width: 40px; fill: #10b981; } 
            20% { width: 20px; fill: #eab308; } 
            60% { width: 5px; fill: #ef4444; } /* Fin descarga */
            100% { width: 5px; fill: #ef4444; } /* Pausa */
        }

        /* Vaciado vertical con ScaleY y pausa */
        @keyframes brain-liquid-drain {
            0% { transform: scaleY(1); fill: #fbcfe8; } 
            20% { transform: scaleY(0.5); fill: #eab308; } 
            60% { transform: scaleY(0.1); fill: #ef4444; } 
            100% { transform: scaleY(0.1); fill: #ef4444; } 
        }
        
        @keyframes travel-shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } 100% { transform: translate(1px, -1px); } }
        @keyframes travel-zigzag { 0% { transform: translateX(-10px); } 100% { transform: translateX(10px); } }
        @keyframes pain-pulse { 0% { transform: scale(1); } 90% { transform: scale(1); } 95% { transform: scale(1.5); } 100% { transform: scale(1); } }
        @keyframes dizzy-sway { 0% { transform: rotate(0deg); } 25% { transform: rotate(2deg); } 75% { transform: rotate(-2deg); } 100% { transform: rotate(0deg); } }
        @keyframes zigzag-small { 0% { transform: translateX(-2px); } 100% { transform: translateX(2px); } }

        /* MEDIA QUERIES */
        @media (min-width: 700px) {
            .scrolly-container { flex-direction: row; }
            .graphic-stage { width: 50%; height: 100vh; }
            .narrative-column { width: 50%; padding-bottom: 40vh; margin-top: 0; }
            .text-card { max-width: 80%; padding: 2.5rem; }
        }
    </style>
</head>
<body>

    <main class="scrolly-container">
        
        <div class="graphic-stage" id="graphicStage">
            <svg viewBox="0 0 400 600" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
                
                <g id="main-scene">
                    
                    <!-- CLIP-PATH L√çQUIDO -->
                    <defs>
                        <clipPath id="brainClip">
                            <path d="M-40,20 C-50,10 -50,-10 -40,-20 C-40,-40 -10,-50 0,-45 C10,-50 40,-40 40,-20 C50,-10 50,10 40,20 C40,40 10,45 0,45 C-10,45 -40,40 -40,20 Z" />
                        </clipPath>
                    </defs>

                    <!-- CEREBRO -->
                    <g transform="translate(200, 80)">
                        <path class="headset" d="M-60,10 C-60,-50 60,-50 60,10 L60,30 L50,30 L50,10 C50,-40 -50,-40 -50,10 L-50,30 L-60,30 Z" />
                        <rect class="headset" x="-65" y="25" width="15" height="25" rx="5" />
                        <rect class="headset" x="50" y="25" width="15" height="25" rx="5" />
                        
                        <!-- Tanque L√≠quido (Fondo gris + L√≠quido rosa) -->
                        <g clip-path="url(#brainClip)">
                            <rect x="-60" y="-60" width="120" height="120" fill="#f1f5f9" />
                            <rect class="brain-fill-rect" x="-60" y="-60" width="120" height="120" /> 
                        </g>
                        
                        <path class="brain-outline" d="M-40,20 C-50,10 -50,-10 -40,-20 C-40,-40 -10,-50 0,-45 C10,-50 40,-40 40,-20 C50,-10 50,10 40,20 C40,40 10,45 0,45 C-10,45 -40,40 -40,20 Z" fill="none" stroke="#db2777" stroke-width="2.5" />
                        
                        <!-- BATER√çA SOBRE EL CEREBRO -->
                        <g class="alert-marker battery-container" transform="translate(-25, -70)">
                            <rect class="battery-body" x="0" y="0" width="50" height="25" rx="3" />
                            <rect class="battery-fill" x="3" y="3" width="40" height="19" rx="1" /> 
                            <rect x="50" y="7" width="4" height="11" fill="#334155" />
                        </g>

                        <text x="0" y="10" class="alert-marker alert-dizzy" style="font-size: 50px;">üåÄ</text>
                        <text x="0" y="-30" class="hardware-ok" style="font-weight: bold;">‚úî</text>
                    </g>

                    <!-- CABLES RECTOS -->
                    <path id="pRojo" class="cable c-straight stroke-red" d="M170,125 C150,200 60,300 60,500" />
                    <path id="pAzul" class="cable c-straight stroke-blue" d="M185,125 C180,200 130,300 130,500" />
                    <path id="pVerde" class="cable c-straight stroke-green" d="M200,125 C200,200 200,300 200,500" />
                    <path id="pAmarillo" class="cable c-straight stroke-yellow" d="M215,125 C220,200 270,300 270,500" />
                    <path id="pNaranja" class="cable c-straight stroke-orange" d="M230,125 C250,200 340,300 340,500" />

                    <!-- CABLES ENREDADOS -->
                    <path id="pRojoBad" class="cable c-tangled stroke-red" d="M170,125 C170,250 250,250 200,500" />
                    <path id="pAzulBad" class="cable c-tangled stroke-blue" d="M185,125 C185,250 100,250 60,500" />
                    <path id="pVerdeBad" class="cable c-tangled stroke-green" d="M200,125 C200,200 300,300 270,500" />
                    <path id="pAmarilloBad" class="cable c-tangled stroke-yellow" d="M215,125 C250,200 200,300 340,500" />
                    <path id="pNaranjaBad" class="cable c-tangled stroke-orange" d="M230,125 C150,200 200,300 130,500" />

                    <!-- ICONOS DESTINO -->
                    <g transform="translate(60, 540)"><text class="dest-icon icon-hand">üëã</text><text y="-30" class="hardware-ok">‚úî</text></g>
                    <g transform="translate(130, 540)"><text class="dest-icon icon-speech">üí¨</text><text y="-30" class="hardware-ok">‚úî</text></g>
                    <g transform="translate(200, 540)"><text class="dest-icon icon-heart">‚ù§Ô∏è</text><text y="-30" class="hardware-ok">‚úî</text></g>
                    <g transform="translate(270, 540)"><text class="dest-icon icon-sleep">üí§</text><text y="-30" class="hardware-ok">‚úî</text></g>
                    <g transform="translate(340, 540)"><text class="dest-icon icon-foot">ü¶∂</text><text y="-30" class="hardware-ok">‚úî</text></g>

                    <!-- ALERTAS FINALES -->
                    <text x="60" y="480" class="alert-marker alert-tremor">‚ö°</text> 
                    <text x="340" y="480" class="alert-marker alert-gait">‚ùì</text> 
                    <text x="130" y="480" class="alert-marker alert-speech">#?!</text> 
                    <text x="200" y="480" class="alert-marker alert-pain" style="font-size: 50px; fill: #ef4444;">‚ö°</text> 

                    <!-- SE√ëALES (Puntos normales) -->
                    <!-- FIX: r="4" en HTML para Firefox -->
                    <g class="dots-normal">
                        <circle class="signal-dot fill-red" r="4" data-path="pRojo" />
                        <circle class="signal-dot fill-blue" r="4" data-path="pAzul" />
                        <circle class="signal-dot fill-green" r="4" data-path="pVerde" />
                        <circle class="signal-dot fill-yellow" r="4" data-path="pAmarillo" />
                        <circle class="signal-dot fill-orange" r="4" data-path="pNaranja" />
                    </g>
                    
                    <!-- SE√ëALES (Puntos Caos Generales) -->
                    <g class="dots-chaos">
                        <circle class="signal-dot fill-red" r="4" data-path="pRojoBad" />
                        <circle class="signal-dot fill-blue" r="4" data-path="pAzulBad" />
                        <circle class="signal-dot fill-green" r="4" data-path="pVerdeBad" />
                        <circle class="signal-dot fill-yellow" r="4" data-path="pAmarilloBad" />
                        <circle class="signal-dot fill-orange" r="4" data-path="pNaranjaBad" />
                    </g>

                    <!-- VIAJEROS ESPECIALES (Tama√±o 30px) -->
                    <text class="traveler-emoji trav-hand" data-path="pRojoBad">üëã</text>
                    <text class="traveler-emoji trav-foot" data-path="pNaranjaBad">ü¶∂</text>
                    <text class="traveler-emoji trav-speech" data-path="pAzulBad" style="font-size:30px; font-weight:bold;">#?!</text>
                    <text class="traveler-emoji trav-pain" data-path="pVerdeBad">‚ö°</text>

                    <!-- ESC√ÅNER -->
                    <line class="scan-laser" x1="20" y1="100" x2="380" y2="100" />
                </g>

            </svg>
        </div>

        <div class="narrative-column">
            <!-- PASOS (Texto en Valenciano) -->
            <div class="step" data-step="1">
                <div class="text-card">
                    <h2>üéß La centraleta</h2>
                    <p>El teu cervell envia ordres per cables de colors: Roig a la m√†, Blau a la veu...</p>
                </div>
            </div>
            <div class="step" data-step="2">
                <div class="text-card" style="border-left-color: #64748b;">
                    <h2>ü™¢ Cables creuats!</h2>
                    <p>Amb el TNF, els cables s'emboliquen. Els senyals es perden o van al lloc incorrecte.</p>
                </div>
            </div>
            <div class="step" data-step="3">
                <div class="text-card" style="border-left-color: var(--c-red);">
                    <h2>üëã Tremolors/convulsions</h2>
                    <p>Mira el cable roig. L'ordre "m√† quieta" es converteix en una m√† tremolosa. De vegades, el cos acaba fent convulsions no epil√©ptiques.</p>
                </div>
            </div>
            <div class="step" data-step="4">
                <div class="text-card" style="border-left-color: var(--c-yellow);">
                    <h2>ü™´ Fatiga</h2>
                    <p>El sistema gasta tanta energia en el caos que la bateria s'esgota.</p>
                </div>
            </div>
            <div class="step" data-step="5">
                <div class="text-card" style="border-left-color: var(--c-orange);">
                    <h2>ü¶∂ Caminar mal</h2>
                    <p>Mira el cable taronja. El peu baixa fent un zig-zag inestable.</p>
                </div>
            </div>
            <div class="step" data-step="6">
                <div class="text-card" style="border-left-color: #8b5cf6;">
                    <h2>üåÄ Desequilibri</h2>
                    <p>L'equilibri falla. Tot el gr√†fic comen√ßa a balancejar-se.</p>
                </div>
            </div>
            <div class="step" data-step="7">
                <div class="text-card" style="border-left-color: var(--c-blue);">
                    <h2>üí¨ Bloqueig</h2>
                    <p>Pel cable blau no baixen paraules clares, baixen s√≠mbols de confusi√≥.</p>
                </div>
            </div>
            <div class="step" data-step="8">
                <div class="text-card" style="border-left-color: var(--c-green);">
                    <h2>‚ö° Dolor</h2>
                    <p>El cable verd llan√ßa fuetades de dolor (llampecs) encara que no hi haja ferida.</p>
                </div>
            </div>
            <div class="step" data-step="9">
                <div class="text-card" style="border-left-color: #10b981;">
                    <h2>üîç L'esc√†ner</h2>
                    <p>En escanejar, veiem que els cables f√≠sics estan intactes. √âs nom√©s programaci√≥.</p>
                </div>
            </div>
            <div class="step" data-step="10">
                <div class="text-card" style="border-left-color: #3b82f6;">
                    <h2>üß© Reprogramaci√≥</h2>
                    <p>Amb ter√†pia multidisciplinar (fisio, logopeda, psicol√≤gica...), desemboliquem el nus i tot torna a fluir.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // MOTOR JS ESTABLE (TIPO EJEMPLO USUARIO)
        const travelers = document.querySelectorAll('.signal-dot, .traveler-emoji');
        
        travelers.forEach(el => {
            const pathId = el.dataset.path;
            const path = document.getElementById(pathId);
            
            if (path) {
                const length = path.getTotalLength();
                // Velocidad: longitud * factor peque√±o
                const speed = 0.00015 + Math.random() * 0.0002; 
                const offset = Math.random() * length; 
                let start = performance.now();

                function move(t) {
                    // L√≥gica del ejemplo usuario
                    const dist = (offset + ((t - start) * speed * length)) % length;
                    const point = path.getPointAtLength(dist);
                    
                    if (el.tagName.toLowerCase() === 'text') {
                        el.setAttribute('x', point.x);
                        el.setAttribute('y', point.y);
                    } else {
                        el.setAttribute('cx', point.x);
                        el.setAttribute('cy', point.y);
                    }
                    requestAnimationFrame(move);
                }
                requestAnimationFrame(move);
            }
        });

        // SCROLL
        const graphicStage = document.getElementById('graphicStage');
        const steps = document.querySelectorAll('.step');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
                    entry.target.classList.add('active');
                    const stepNumber = entry.target.dataset.step;
                    graphicStage.className = 'graphic-stage'; 
                    graphicStage.classList.add(`state-${stepNumber}`);
                }
            });
        }, { threshold: 0.6, rootMargin: "-10% 0px -10% 0px" });
        steps.forEach(step => observer.observe(step));
    </script>
</body>
</html>